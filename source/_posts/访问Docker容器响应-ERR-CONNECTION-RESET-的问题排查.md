---
title: è®¿é—®Dockerå®¹å™¨å“åº”'ERR_CONNECTION_RESET'çš„é—®é¢˜æ’æŸ¥
tags:
  - Docker
abbrlink: 6e5db5aa
date: 2020-06-10 14:14:39
---

# å‰è¨€

æ¥åˆ°åé¦ˆè¯´åˆšæ‰å¥½å¥½çš„å•ä½“Dockerå®¹å™¨æ— æ³•è®¿é—®äº†ã€‚æµè§ˆå™¨è®¿é—®è¶…æ—¶å¹¶æ˜¾ç¤º`ERR_CONNECTION_RESET`ã€‚

# é—®é¢˜æ’æŸ¥

é¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯æœåŠ¡æŒ‚äº†ï¼Œä½†æ˜¯ä»`docker ps -a`æ¥çœ‹ï¼Œå®¹å™¨è¿è¡Œè‰¯å¥½ï¼Œä¸”éƒ½å¯¹å¤–å¼€æ”¾äº†ç›¸åº”çš„ç«¯å£ã€‚

## 1. æ’æŸ¥ç«¯å£

å®¿ä¸»æœºä½¿ç”¨ `lo` ç½‘å¡è®¿é—®å“åº”ç«¯å£ï¼Œçœ‹ä¸‹ç«¯å£è¿é€šæ€§ã€‚

```bash
> wget -O- 127.0.0.1:8500
[root@localhost ~]# wget -O- 127.0.0.1:8500
--2020-06-10 22:25:43--  http://127.0.0.1:8500/
æ­£åœ¨è¿æ¥ 127.0.0.1:8500... å·²è¿æ¥ã€‚
å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... è¯»å–æ–‡ä»¶å¤´é”™è¯¯ï¼ˆConnection reset by peerï¼‰ã€‚
é‡è¯•ä¸­ã€‚
...
```

é¦–å…ˆç¡®è®¤ç«¯å£æ˜¯é€šçš„ï¼Œä½†æ˜¯è¢«æ‹’ç»äº†ï¼Œä¸‹é¢æŠ“åŒ…çœ‹ä¸€ä¸‹ã€‚å¯åŠ¨æŠ“åŒ…å¹¶é‡æ–°å‘é€ wget è¯·æ±‚

```bash
> tcpdump port 8500 -i lo -vvv -w /srv/out.cap
```

![](https://gsealy-1257917518.cos.ap-beijing.myqcloud.com/gsealy.github.io/docker/capture-rst.png)

æ­£å¸¸å‘é€HTTPè¯·æ±‚ï¼Œæ”¶åˆ°äº†RSTã€‚æ‰€ä»¥æµè§ˆå™¨æ‰ä¼šæ˜¾ç¤º`ERR_CONNECTION_RESET`

ç»æŸ¥ï¼Œç«¯å£æ²¡é—®é¢˜ã€‚

## 2. æ’æŸ¥å®¹å™¨

å·²ç»çŸ¥é“äº†å®¿ä¸»æœºè®¿é—®ä¼šå‡ºç°é—®é¢˜ï¼Œé‚£å°±çœ‹ä¸‹åœ¨å®¹å™¨å†…è®¿é—®èƒ½ä¸èƒ½æ­£å¸¸å“åº”ï¼Œè¿›å…¥ä¸€ä¸ªå’Œç›®æ ‡å®¹å™¨ç›¸åŒå­ç½‘çš„å®¹å™¨ã€‚è¿™é‡Œä»¥busyboxä¸ºä¾‹ï¼Œå­ç½‘ä½¿ç”¨çš„ `bridge` æ¨¡å¼ï¼Œå®¹å™¨å¯åŠ¨æ—¶é€‰æ‹©ç›¸åŒçš„ Docker ç½‘å¡å³å¯

```bash
> docker exec -it busybox sh
> wget -O- 192.168.24.151:8500
Connecting to 192.168.24.151:8500 (192.168.24.151:8500)
*** HTML å†…å®¹ ***
```

èƒ½æ­£å¸¸å“åº”é¡µé¢ï¼Œåœ¨ç›¸åŒå­ç½‘å†…è®¿é—®æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚

## 3. æ’æŸ¥ç½‘å¡

ä»å‰ä¸¤é¡¹æ’æŸ¥å¯çŸ¥ï¼Œå®¿ä¸»æœºæ— æ³•è®¿é—®ï¼ŒDockerå­ç½‘å†…å¯ä»¥è®¿é—®ã€‚é‚£å°±æ˜¯ç½‘å¡åº”è¯¥å‡ºç°äº†é—®é¢˜ã€‚å› ä¸ºæ˜¯æ‰€æœ‰å®¹å™¨éƒ½æ˜¯è·‘åœ¨æ–°å»ºçš„ç½‘å¡ä¸‹é¢çš„ï¼Œæ‰€ä»¥ç›´æ¥æŸ¥çœ‹å®¿ä¸»æœºç½‘å¡ä¿¡æ¯

![](https://gsealy-1257917518.cos.ap-beijing.myqcloud.com/gsealy.github.io/docker/duplicate-interface.png)

å±…ç„¶æœ‰ä¸¤ä¸ªç›¸åŒçš„ç½‘å¡ï¼Œå±…ç„¶æ˜¯å› ä¸ºç½‘å¡å†²çªäº†ã€‚ä¸Šä¸€ä¸ªå‡ºå…¥æµé‡å¾ˆé«˜ï¼Œåä¸€ä¸ªå°±å¾ˆä½ã€‚æŸ¥çœ‹ç°åœ¨æ­£åœ¨ä½¿ç”¨çš„ç½‘å¡IDï¼Œæ˜¯ç”¨çš„ä¸Šé¢è¿™ä¸ªæµé‡é«˜çš„ç½‘å¡ï¼Œè€Œä¸”åä¸€ä¸ªç½‘å¡ä¹Ÿæ²¡æœ‰çœ‹åˆ°å¯¹åº”çš„ç½‘ç»œä¿¡æ¯ã€‚

```bash
[root@localhost ~]# docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
edbd45482644        bridge              bridge              local
a0b6ef0cf177        host                host                local
715b7fddecd5        xxx-network         bridge              local
ef3d1b9a5ebc        none                null                local
```

åˆ æ‰æ²¡ç”¨çš„é‚£ä¸ªç½‘å¡å°±å¯ä»¥äº†

```bash
> ip link delete br-fae0e0150543
```

# æ€»ç»“

ç½‘å¡å†²çªå¸¦æ¥çš„è¿æ¥é‡ç½®ï¼Œé€šè¿‡åæœŸæŸ¥è¯¢[è§£å†³ç½‘å¡å†²çª](https://blog.csdn.net/kunkliu/article/details/79082886)å¾—çŸ¥ï¼ŒLinuxå†…æ ¸é»˜è®¤æ˜¯ç»™ARPåšäº†VIPçš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªç½‘å¡éƒ½å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯dockerä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„ç½‘å¡å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚ğŸ”š

------

